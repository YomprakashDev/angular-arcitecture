@if(isLoading()){
<app-loading-spinner [show]="true"></app-loading-spinner>
} @if (error()) {
<div class="mt-4 p-3 rounded border border-red-200 bg-red-50 text-red-800 text-sm">
  {{ error() }}
</div>
} @if(!isLoading() && !isAddView() && !error() ) {
<app-card>
  <div class="page-header">
    <h1>Packages</h1>
    <button (click)="openCreate()" class="mb-2 primary-btn flex items-center">
      <lucide-angular [img]="icons.plus" class="mr-2 text-white"></lucide-angular>
      Create New Package
    </button>
  </div>

  <div class="table-wrap mt-2">
    <table matSort mat-table [dataSource]="dataSource" class="mat-elev-0 packages-table">
      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let pkg">
          <button matTooltip="View"
            matTooltipPosition="below" mat-icon-button type="button" aria-label="View package">
            <lucide-angular [img]="icons.view" class="text-gray-subtleAlt text-lg"></lucide-angular>
          </button>
          <button   matTooltip="Edit"
            matTooltipPosition="below"  mat-icon-button type="button" aria-label="Edit package">
            <lucide-angular [img]="icons.edit" class="text-gray-subtleAlt text-lg"></lucide-angular>
          </button>
        </td>
      </ng-container>

      <!-- Status  -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef >Status</th>
        <td mat-cell *matCellDef="let pkg">

          <app-toggle-switch     [toolTipPosition]="'right'" (stateChange)="onToggelChange(pkg)" [isChecked]="pkg.status"></app-toggle-switch>
        </td>
      </ng-container>

      <!-- Package Name (sortable) -->
      <ng-container matColumnDef="packageName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Package Name</th>
        <td mat-cell *matCellDef="let pkg" class="muted-strong">
          {{ pkg.packageName }}
        </td>
      </ng-container>

      <!-- Modules (not sortable by default) -->
      <ng-container matColumnDef="modules">
        <th mat-header-cell *matHeaderCellDef>Modules</th>
        <td mat-cell *matCellDef="let pkg">
          <span class="pill" *ngFor="let m of pkg.modules">{{ m }}</span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <!--  paginator -->
    <mat-paginator
      [pageSize]="6"
      [pageSizeOptions]="[5, 10, 25, 50, 100]"
      showFirstLastButtons
      aria-label="Modules pagination"
    ></mat-paginator>
  </div>
</app-card>

} @if(isAddView()){
<app-add-view-packages></app-add-view-packages>
}
