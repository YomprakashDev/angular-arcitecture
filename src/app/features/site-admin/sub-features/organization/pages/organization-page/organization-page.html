<!-- organization-page.html -->

@if (isLoading()) {
<!-- loading overlay -->
<div class="loading-overlay">
  <mat-progress-spinner
    mode="indeterminate"
    diameter="48"
    aria-label="Loading"
  ></mat-progress-spinner>
</div>
} @else {
<div class="flex w-full h-full bg-white rounded-lg">
    <div class="flex-1 p-6">
      <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-[#1D1D21]">Organizations List</h1>
        <app-button (clicked)="addOrganization()" text="Add Organization" variant="primary"></app-button>
      </div>

      @if (error()) {
        <div class="mt-4 p-3 rounded border border-red-200 bg-red-50 text-red-800 text-sm">{{ error() }}</div>
      }

      <div class="flex items-center justify-center p-4">
        <div class="flex items-center justify-between w-full">
          <app-tabs
            [tabs]="tabs()"
            (tabChanged)="setActiveTab($event.id)"
            [defaultActiveTab]="'active'">
          </app-tabs>

          <div class="flex items-center space-x-4">
            <div class="relative w-72">
              <label class="sr-only" for="org-search">Search organizations</label>
              <svg
                class="absolute text-gray-400 transform -translate-y-1/2 left-3 top-1/2"
                width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <input
                id="org-search"
                type="text"
                placeholder="Search here"
                class="w-full pl-10 pr-4 py-2 rounded-lg placeholder:text-[#787A7F] font-normal border border-[#d9d9d9] focus:outline-none text-sm"
               />
            </div>

            <app-button text="Export" variant="secondary"></app-button>
          </div>
        </div>
      </div>

      <div class="card">
        <!-- Bind directly to the array signal; no computed(), no MatTableDataSource -->
        <table mat-table [dataSource]="organizations()" class="orgs-table mat-elev-0">
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef scope="col">Actions</th>
            <td mat-cell *matCellDef="let org">
              <div class="actions">
                <button type="button" mat-icon-button matTooltip="View" aria-label="View"><mat-icon>visibility</mat-icon></button>
                <button type="button" mat-icon-button matTooltip="Edit" aria-label="Edit"><mat-icon>edit</mat-icon></button>
                <button type="button" mat-icon-button matTooltip="Duplicate" aria-label="Duplicate"><mat-icon>content_copy</mat-icon></button>
                <button type="button" mat-icon-button matTooltip="Settings" aria-label="Settings"><mat-icon>settings</mat-icon></button>
                <button type="button" mat-icon-button matTooltip="Download" aria-label="Download"><mat-icon>cloud_download</mat-icon></button>
                <button type="button" mat-icon-button matTooltip="Open" aria-label="Open"><mat-icon>open_in_new</mat-icon></button>
                <button type="button" mat-icon-button matTooltip="Delete" aria-label="Delete"><mat-icon>delete_outline</mat-icon></button>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="organization">
            <th mat-header-cell *matHeaderCellDef scope="col">Organization Name</th>
            <td mat-cell *matCellDef="let org" class="muted-strong">
              {{ org.orgDetails?.organizationName }}
            </td>
          </ng-container>

          <ng-container matColumnDef="contactPerson">
            <th mat-header-cell *matHeaderCellDef scope="col">Contact Person</th>
            <td mat-cell *matCellDef="let org">
              {{ org.contactDetails?.contactPersonName }}
            </td>
          </ng-container>

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef scope="col">Email</th>
            <td mat-cell *matCellDef="let org">
              <a class="link" [href]="'mailto:' + org.contactDetails?.emailID">
                {{ org.contactDetails?.emailID }}
              </a>
            </td>
          </ng-container>

          <ng-container matColumnDef="phone">
            <th mat-header-cell *matHeaderCellDef scope="col">Phone</th>
            <td mat-cell *matCellDef="let org">
              {{ org.contactDetails?.contactNumber }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </div>
  </div>
}

<!-- modal -->
@if (isAddOrganizationModalOpen()) {
<div class="modal-overlay">
  <app-add-oraganization-model (close)="closeModal()"></app-add-oraganization-model>
</div>
}
