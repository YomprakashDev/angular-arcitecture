<!-- organization-page.html -->

@if (isLoading()) {
<!-- loading overlay -->
<div class="loading-overlay" aria-live="polite">
  <mat-progress-spinner
    mode="indeterminate"
    diameter="48"
    aria-label="Loading"
  ></mat-progress-spinner>
</div>

} @if (error()) {
<div class="mt-4 p-3 rounded border border-red-200 bg-red-50 text-red-800 text-sm">
  {{ error() }}
</div>
} @if(!isLoading() && !error() ) {
<div class="flex w-full h-full bg-white rounded-lg">
  <div class="flex-1 p-6">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-bold text-[#1D1D21]">Organizations List</h1>
      <app-button
        (clicked)="addOrganization()"
        text="Add Organization"
        variant="primary"
      ></app-button>
    </div>


    <div class="flex items-center justify-center p-4">
      <div class="flex items-center justify-between w-full">
        <app-tabs
          [tabs]="tabs()"
          (tabChanged)="setActiveTab($event.id)"
          [defaultActiveTab]="'active'"
          [activeTabInput]="activeTab()"
        >
        </app-tabs>

        <div class="flex items-center space-x-4">
          <div class="relative w-72">
            <label class="sr-only" for="org-search">Search organizations</label>
            <svg
              class="absolute text-gray-400 transform -translate-y-1/2 left-3 top-1/2"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
              id="org-search"
              type="text"
              placeholder="Search here"
              class="w-full pl-10 pr-4 py-2 rounded-lg placeholder:text-[#787A7F] font-normal border border-[#d9d9d9] focus:outline-none text-sm"
            />
          </div>

          <app-button text="Export" variant="secondary"></app-button>
        </div>
      </div>
    </div>

    <div class="card">
      <!-- Bind directly to the array signal; no computed(), no MatTableDataSource -->
      <table mat-table [dataSource]="organizations()" class="orgs-table mat-elev-0">
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef scope="col">Actions</th>
          <td mat-cell *matCellDef="let org">
            <div class="flex items-center">
              <button (click)="viewOrganization(org)" mat-icon-button aria-label="View module">
                <lucide-angular [img]="viewIcon" class="text-[#787A7F] text-xs"></lucide-angular>
              </button>
              <button mat-icon-button aria-label="Edit module">
                <lucide-angular [img]="editIcon" class="text-[#787A7F] text-xs"></lucide-angular>
              </button>
              <button mat-icon-button aria-label=" module">
                <lucide-angular [img]="fileIcon" class="text-[#787A7F] text-xs"></lucide-angular>
              </button>
              <button mat-icon-button aria-label="View module">
                <lucide-angular [img]="cogIcon" class="text-[#787A7F] text-xs"></lucide-angular>
              </button>
              <button mat-icon-button aria-label="View module">
                <lucide-angular [img]="logoutIcon" class="text-[#787A7F] text-xs"></lucide-angular>
              </button>
              <button
                (click)="inActiveOrganization(org)"
                mat-icon-button
                aria-label="inactive module"
              >
                <lucide-angular [img]="closeIcon" class="text-[#787A7F] text-xs"></lucide-angular>
              </button>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="organization">
          <th mat-header-cell *matHeaderCellDef scope="col">Organization Name</th>
          <td mat-cell *matCellDef="let org" class="muted-strong">
            {{ org.orgDetails?.organizationName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="contactPerson">
          <th mat-header-cell *matHeaderCellDef scope="col">Contact Person</th>
          <td mat-cell *matCellDef="let org">
            {{ org.contactDetails?.contactPersonName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef scope="col">Email</th>
          <td mat-cell *matCellDef="let org">
            <a class="link" [href]="'mailto:' + org.contactDetails?.emailID">
              {{ org.contactDetails?.emailID }}
            </a>
          </td>
        </ng-container>

        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef scope="col">Phone</th>
          <td mat-cell *matCellDef="let org">
            {{ org.contactDetails?.contactNumber }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <!-- <mat-paginator [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 50]" showFirstLastButtons>
  </mat-paginator> -->
    </div>
  </div>
</div>
} @if(isViewOrganizationModalOpen()){
<app-organization-details
  [organizationDetails]="viewOrganizationDetails()"
></app-organization-details>
}

<!-- modal -->
@if (isAddOrganizationModalOpen()) {
<div class="modal-overlay">
  <app-add-oraganization-model (close)="closeModal()"></app-add-oraganization-model>
</div>
} @if(isInactiveOrganizationModalOpen()) {
<div class="modal-overlay">
  @if (isInactiveOrganizationModalOpen()) {
  <!-- Backdrop -->
  <div class="fixed inset-0 z-40 bg-black/30" aria-hidden="true"></div>

  <!-- Dialog -->
  <div
    class="fixed inset-0 z-50 flex overflow-hidden items-center justify-center p-4"
    role="dialog"
    aria-modal="true"
    aria-labelledby="confirmTitle"
  >
    <div class="w-full max-w-md rounded-2xl bg-white shadow-xl">
      <!-- Red top border -->
      <div class="h-2 w-full rounded-t-2xl bg-red-500"></div>

      <div class="px-8 pb-8 pt-6 text-center">
        <!-- Red circle with X -->
        <div
          class="mx-auto mb-5 flex h-14 w-14 items-center justify-center rounded-full border-4 border-red-200"
        >
          <svg viewBox="0 0 24 24" class="h-7 w-7 text-red-500" aria-hidden="true">
            <path
              fill="currentColor"
              d="M6.4 5l-.7.7L11 11l-5.3 5.3.7.7L11.7 12l5.3 5.3.7-.7L12.4 11l5.3-5.3-.7-.7L11.7 10.3 6.4 5z"
            />
          </svg>
        </div>

        <h2 id="confirmTitle" class="mb-7 text-xl font-semibold text-gray-900">
          Are you sure, you want to Inactive
        </h2>

        <div class="flex items-center justify-center gap-4">
          <button
            (click)="cancleInactiveOrganization()"
            type="button"
            class="min-w-[110px] rounded-lg border border-gray-300 px-6 py-3 text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300"
          >
            Cancel
          </button>

          <button
            type="button"
            class="min-w-[110px] rounded-lg bg-red-500 px-6 py-3 text-base font-semibold text-white hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
          >
            Yes
          </button>
        </div>
      </div>
    </div>
  </div>
  }
</div>
}
