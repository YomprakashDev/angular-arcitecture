<!-- organization-page.html -->

@if (isLoading()) {
<app-loading-spinner [show]="isLoading()" [diameter]="48"></app-loading-spinner>

} @if (error()) {
<app-error-banner [message]="error()"></app-error-banner>
} @if(!isLoading() && !error() && !isViewOrganizationModalOpen()) {
<div class="flex w-full h-full bg-white rounded-lg">
  <div class="flex-1 p-6">
    <div class="flex items-center w-full justify-between">
      <h1 class="text-2xl font-bold text-foreground">Organizations List</h1>
      <app-button (clicked)="addOrganization()" text="Add Organization" variant="primary">
        <lucide-angular [img]="icons.plus" class="text-white text-xs"></lucide-angular>
      </app-button>
    </div>

    <div class="flex items-center justify-center">
      <div class="flex items-center justify-between w-full">
        <app-tabs
          [tabs]="tabsWithCounts()"
          (tabChanged)="setActiveTab($event.id)"
          [defaultActiveTab]="'active'"
          [activeTabInput]="activeTab()"
        >
        </app-tabs>

        <div class="flex items-center space-x-4">
          <div class="relative w-72">
            <label class="sr-only" for="org-search">Search organizations</label>
            <lucide-angular
              [img]="icons.search"
              class="absolute left-1 top-1/2 -translate-y-1/2 text-gray-subtleAlt text-xs"
            ></lucide-angular>
            <input
              type="text"
              id="org-search"
              placeholder="Search organizations"
              class="block w-full py-2 pl-10 pr-4 text-gray-900 border border-gray-300 rounded-md bg-gray-50 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>

          <app-button (clicked)="exportToExcel()" text="Export" variant="secondary"></app-button>
        </div>
      </div>
    </div>

    <div class="card">
      <table mat-table [dataSource]="dataSource" class="orgs-table mat-elev-0">
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef scope="col">Actions</th>
          <td mat-cell *matCellDef="let org">
            <div class="flex items-center">
              <button
                mat-icon-button
                matTooltip="View"
                matTooltipPosition="below"
                (click)="viewOrganization(org)"
                mat-icon-button
                aria-label="View module"
              >
                <lucide-angular
                  [img]="icons.view"
                  class="text-gray-subtleAlt text-xs"
                ></lucide-angular>
              </button>
              <button
                mat-icon-button
                matTooltip="Edit"
                matTooltipPosition="below"
                aria-label="Edit module"
              >
                <lucide-angular
                  [img]="icons.edit"
                  class="text-gray-subtleAlt text-xs"
                ></lucide-angular>
              </button>
              <button
                mat-icon-button
                matTooltip="Repository"
                matTooltipPosition="below"
                aria-label="module"
              >
                <lucide-angular
                  [img]="icons.file"
                  class="text-gray-subtleAlt text-xs"
                ></lucide-angular>
              </button>
              <button
                mat-icon-button
                matTooltip="Settings"
                matTooltipPosition="below"
                aria-label=""
              >
                <lucide-angular
                  [img]="icons.settings"
                  class="text-gray-subtleAlt text-xs"
                ></lucide-angular>
              </button>
              <button
                mat-icon-button
                matTooltip="Creditials"
                matTooltipPosition="below"
                mat-icon-button
                aria-label="View module"
              >
                <img src="assets/icons/svgs/cloud-access.svg" class="text-gray-subtleAlt text-xs" />
              </button>
              <button
                mat-icon-button
                matTooltip="Remove"
                matTooltipPosition="below"
                mat-icon-button
                aria-label=" module"
              >
                <lucide-angular
                  [img]="icons.logout"
                  class="text-gray-subtleAlt text-xs"
                ></lucide-angular>
              </button>
              <button
                (click)="inActiveOrganization(org)"
                mat-icon-button
                matTooltip="In Activate"
                aria-label="inactive module"
                *ngIf="org.orgDetails?.status === true"
              >
                <lucide-angular
                  [img]="icons.close"
                  class="text-gray-subtleAlt text-xs"
                ></lucide-angular>
              </button>
              <button
                (click)="activateOrganization(org)"
                *ngIf="org.orgDetails?.status === false"
                mat-icon-button
                matTooltip="Activate"
                aria-label="Activate"
              >
                <lucide-angular
                  [img]="icons.circleCheck"
                  class="text-gray-subtleAlt text-xs"
                ></lucide-angular>
              </button>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="organization">
          <th mat-header-cell *matHeaderCellDef scope="col">Organization Name</th>
          <td mat-cell *matCellDef="let org" class="muted-strong">
            {{ org.orgDetails?.organizationName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="contactPerson">
          <th mat-header-cell *matHeaderCellDef scope="col">Contact Person</th>
          <td mat-cell *matCellDef="let org">
            {{ org.contactDetails?.contactPersonName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef scope="col">Email</th>
          <td mat-cell *matCellDef="let org">
            <a class="link" [href]="'mailto:' + org.contactDetails?.emailID">
              {{ org.contactDetails?.emailID }}
            </a>
          </td>
        </ng-container>

        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef scope="col">Phone</th>
          <td mat-cell *matCellDef="let org">
            {{ org.contactDetails?.contactNumber }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      <mat-paginator [pageSize]="6" [pageSizeOptions]="[5, 10, 25, 50, 100]" showFirstLastButtons>
      </mat-paginator>
    </div>
  </div>
</div>
} @if(isViewOrganizationModalOpen()){
<app-organization-details
  (closeView)="closeViewOrgModel()"
  [organizationDetails]="viewOrganizationDetails()"
></app-organization-details>
}

<!-- modal -->
@if (isAddOrganizationModalOpen()) {
<div class="modal-overlay">
  <app-add-oraganization-model (close)="closeModal()"></app-add-oraganization-model>
</div>
}

<!-- active / inactive modal -->
@if(isInactiveOrganizationModalOpen()) {
<app-confirm-dialog
  [open]="isInactiveOrganizationModalOpen()"
  [text]="'Are you sure you want to inactivate?'"
  confirmText="Yes"
  cancelText="Cancel"
  variant="danger"
  (closed)="closeInactiveModel()"
  (confirm)="updateInactiveStatus()"
></app-confirm-dialog>
}

<!-- active / inactive modal -->
@if(isConfirmStatusOpen()) {
<app-confirm-dialog
  [open]="isConfirmStatusOpen()"
  [text]="'Are you sure you want to Activate?'"
  confirmText="Yes"
  cancelText="Cancel"
  variant="success"
  (closed)="closeInactiveModel()"
  (confirm)="updateInactiveStatus()"
></app-confirm-dialog>
}
