@if (isLoading() ) {
<div class="loading-overlay">
  <mat-progress-spinner
    mode="indeterminate"
    diameter="48"
    aria-label="Loading"
  ></mat-progress-spinner>
</div>
} @else{
<div class="flex w-full h-full bg-white rounded-lg">
  <div class="flex-1 p-6">
    <div class="flex justify-between w-full">
      <h1 class="text-2xl mb-4 font-bold text-[#1D1D21]">Modules</h1>
      <!-- <app-button text="Export to Excel" variant="primary" ></app-button> -->
    </div>
    <div class="relative overflow-hidden rounded-lg module-table border border-[#eaeaea]">
      <!-- overlay spinner while loading -->

      <table matSort mat-table [dataSource]="dataSource" class="w-full bg-white">
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="tracking-wider">Actions</th>
          <td mat-cell *matCellDef="let module" class="flex items-center whitespace-nowrap">
            <span class="mr-2 cursor-move drag-handle" aria-label="Drag handle">
              <lucide-angular [img]="dragIcon" class="text-[#787A7F]"></lucide-angular>
            </span>
            @if (editingModuleId() !== module.id) {
            <button
              (click)="editModule(module)"
              mat-icon-button
              class="edit-icon"
              aria-label="Edit module"
            >
              <lucide-angular [img]="editIcon" class="edit-icon text-[#787A7F]"></lucide-angular>
            </button>
            } @else {
            <button
              (click)="saveModule(module)"
              mat-icon-button
              color="primary"
              [disabled]="!isDirty()"
              aria-label="Savemodule"
            >
              <mat-icon>save</mat-icon>
            </button>
            <button
              (click)="cancelEditModule(module)"
              type="button"
              mat-icon-button
              color="warn"
              aria-label="Cancel edit"
            >
              <mat-icon>cancel</mat-icon>
            </button>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="text-sm font-bold tracking-wider text-left text-gray-700"
          >
            Status
          </th>
          <td mat-cell *matCellDef="let module" class="p-4 whitespace-nowrap">
            <label class="switch">
              <input
                type="checkbox"
                [checked]="module.status"
                (change)="toggleModuleStatus(module, $event.target.checked)"
              />

              <span class="slider"></span>
            </label>
          </td>
        </ng-container>

        <ng-container matColumnDef="moduleName">
          <th
            mat-header-cell
            *matHeaderCellDef
            mat-sort-header
            sortActionDescription="Sort by module name"
            class="p-4 text-sm font-bold tracking-wider text-left text-gray-700"
          >
            Module Name
          </th>
          <td
            mat-cell
            *matCellDef="let module"
            class="p-4 whitespace-nowrap font-[Mulish] font-normal text-[14px] leading-[100%] tracking-[0%]"
          >
            @if (editingModuleId() !== module.id) {
            {{ module.moduleName }}
            } @else {

            <input
              class="edit-input"
              matInput
              [ngModel]="editedModuleName()"
              (ngModelChange)="editedModuleName.set($event); onFieldChange()"
              placeholder="Module name"
            />

            }
          </td>
        </ng-container>

        <ng-container matColumnDef="description">
          <th
            mat-header-cell
            *matHeaderCellDef
            mat-sort-header
            sortActionDescription="Sort by description"
            class="text-sm font-bold tracking-wider text-left text-gray-700"
          >
            Description
          </th>
          <td mat-cell *matCellDef="let module" class="p-4">
            @if (editingModuleId() !== module.id) {
            {{ module.description }}
            } @else {

            <input
              class="edit-input"
              matInput
              [ngModel]="editedModuleDescription()"
              (ngModelChange)="editedModuleDescription.set($event); onFieldChange()"
              placeholder="Description"
            />

            }
          </td>
        </ng-container>

        <ng-container matColumnDef="icon">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="p-4 text-sm font-bold tracking-wider text-left text-gray-700"
          >
            Icon
          </th>
          <td mat-cell *matCellDef="let module" class="p-4 whitespace-nowrap">
            <mat-icon class="module-icon">{{ module.icon }}</mat-icon>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        <tr class="mat-row" *ngIf="!isLoading() && (dataSource.data?.length ?? 0) === 0">
          <td
            class="mat-cell p-6 text-center text-gray-500"
            [attr.colspan]="displayedColumns.length"
          >
            No modules found.
          </td>
        </tr>
      </table>

      <!-- <div class="flex items-center justify-between px-3 mt-4">
        <p class="text-sm text-[#182330] font-semibold">
          Showing 1 to 5 entries of {{ module()?.currentPage }} entries
        </p> -->
      <!-- <div>
          <mat-paginator
            [length]="dataSource.data.length"
            [pageSize]="6"
            [pageSizeOptions]="[6]"
            #paginator
            style="display: none"
          ></mat-paginator>

          <div class="flex items-center justify-end mt-4 space-x-4">
            <!-- Previous -->
      <!-- <button
              class="border border-[#CAC6D3] rounded"
              mat-icon-button
              (click)="paginator.previousPage()"
              [disabled]="paginator.hasPreviousPage() === false"
            >
              <mat-icon>chevron_left</mat-icon>
            </button> -->

      <!-- Current Page -->
      <!-- <span class="bg-[#6D7BFA] text-white px-3 py-1 rounded">{{
              paginator.pageIndex + 1
            }}</span> -->

      <!-- Next -->
      <!-- <button
              class="border border-[#CAC6D3] rounded"
              mat-icon-button
              (click)="paginator.nextPage()"
              [disabled]="paginator.hasNextPage() === false"
            >
              <mat-icon>chevron_right</mat-icon>
            </button> -->
      <!-- </div> -->
      <!-- </div> -->
      <!-- </div> -->
    </div>
  </div>
</div>

}
