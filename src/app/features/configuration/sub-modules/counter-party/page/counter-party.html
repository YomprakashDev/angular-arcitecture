<div class="flex bg-white w-full h-full">
  <div class="flex-1 p-6">
    <div class="p-6">
      <!-- Header -->
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-xl font-bold text-[#1D1D21]">Counter Party</h1>

        <button
          (click)="addCounterParty()"
          class="inline-flex items-center gap-2 px-4 border border-[#6D7BFA] text-[16px] rounded-lg bg-[#6D7BFA] text-white py-2.5 text-sm font-bold shadow-sm hover:brightness-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#6C63FF]"
        >
          <lucide-angular [img]="icons.plus" class="text-white"></lucide-angular>
          Add Counter Party
        </button>
      </div>

      <!-- Filters + Search -->
      <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
        <div class="flex items-center gap-3">
          <!-- Type -->
          <mat-form-field appearance="outline" class="w-[160px]">
            <mat-select
              [value]="selectedType()"
              (valueChange)="selectedType.set($event)"
              aria-label="Filter by type"
            >
              <mat-option [value]="''">Type</mat-option>
              @for (t of types; track t) {
              <mat-option [value]="t">{{ t }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <!-- Country -->
          <mat-form-field appearance="outline" class="w-[160px]">
            <mat-select
              [value]="selectedCountry()"
              (valueChange)="selectedCountry.set($event)"
              aria-label="Filter by country"
            >
              <mat-option [value]="''">Country</mat-option>
              @for (c of countries; track c) {
              <mat-option [value]="c">{{ c }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Search -->
        <div class="w-[475px] relative">
          <lucide-angular
            [img]="icons.search"
            class="absolute -translate-y-1/2 text-[#787A7F] edit-icon left-1 top-1/2"
          ></lucide-angular>
          <input
            type="text"
            placeholder="Search here"
            class="w-full pl-10 pr-4 font-normal py-2 rounded-lg placeholder:text-[#787A7F] border border-[#d9d9d9] focus:outline-none text-sm"
          />
        </div>
      </div>

      <!-- Table -->
      <div class="overflow-hidden rounded-xl border border-[#EDEFF2] bg-white">
        <table mat-table [dataSource]="dataSource" matSort class="w-full mat-elevation-0">
          <!-- Actions -->
          <ng-container matColumnDef="actions">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="py-3 bg-[#F6F7FB] text-[#6B7280] font-semibold text-left"
            >
              Actions
            </th>
            <td mat-cell *matCellDef="let r" class="py-3">
              <div class="flex items-center text-[#8A8F98]">
                <button (click)="viewCounterParty(r)" mat-icon-button matTooltip="View">
                  <lucide-angular [img]="icons.view" class="text-[#8A8F98]"></lucide-angular>
                </button>
                <button (click)="editCounterParty()" mat-icon-button matTooltip="Edit">
                  <lucide-angular [img]="icons.edit" class="text-[#8A8F98]"></lucide-angular>
                </button>
                <button (click)="deleteCounterParty()" mat-icon-button matTooltip="Delete">
                  <lucide-angular [img]="icons.delete" class="text-[#8A8F98]"></lucide-angular>
                </button>
              </div>
            </td>
          </ng-container>

          <!-- Name -->
          <ng-container matColumnDef="name">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="py-3 bg-[#F6F7FB] text-[#6B7280] font-semibold text-left"
            >
              Counterparty Name
            </th>
            <td mat-cell *matCellDef="let r" class="py-3">
              <a [href]="r.link || '#'" class="text-[#1B79E7] underline">{{
                r.counterPartyName
              }}</a>
            </td>
          </ng-container>

          <!-- Type -->
          <ng-container matColumnDef="type">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="py-3 bg-[#F6F7FB] text-[#6B7280] font-semibold text-left"
            >
              Type
            </th>
            <td mat-cell *matCellDef="let r" class="py-3 text-[#1D1D21]">
              {{ r.counterPartyType }}
            </td>
          </ng-container>

          <!-- Address -->
          <ng-container matColumnDef="address">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="py-3 bg-[#F6F7FB] text-[#6B7280] font-semibold text-left"
            >
              Address
            </th>
            <td mat-cell *matCellDef="let r" class="py-3 text-[#1D1D21]">{{ r.address }}</td>
          </ng-container>

          <!-- City -->
          <ng-container matColumnDef="city">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="py-3 bg-[#F6F7FB] text-[#6B7280] font-semibold text-left"
            >
              City
            </th>
            <td mat-cell *matCellDef="let r" class="py-3 text-[#1D1D21]">{{ r.cityID }}</td>
          </ng-container>

          <!-- State -->
          <ng-container matColumnDef="state">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="py-3 bg-[#F6F7FB] text-[#6B7280] font-semibold text-left"
            >
              State
            </th>
            <td mat-cell *matCellDef="let r" class="py-3 text-[#1D1D21]">{{ r.stateID }}</td>
          </ng-container>

          <!-- Country -->
          <ng-container matColumnDef="country">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="py-3 bg-[#F6F7FB] text-[#6B7280] font-semibold text-left"
            >
              Country
            </th>
            <td mat-cell *matCellDef="let r" class="py-3 text-[#1D1D21]">{{ r.country }}</td>
          </ng-container>

          <!-- Contact Name -->
          <ng-container matColumnDef="contactName">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="py-3 bg-[#F6F7FB] text-[#6B7280] font-semibold text-left"
            >
              Contact Name
            </th>
            <td mat-cell *matCellDef="let r" class="py-3 text-[#1D1D21]">
              {{ r.personName }}
            </td>
          </ng-container>

          <!-- Contact Number -->
          <ng-container matColumnDef="contactNumber">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="py-3 bg-[#F6F7FB] text-[#6B7280] font-semibold text-left"
            >
              Contact Number
            </th>
            <td mat-cell *matCellDef="let r" class="py-3 text-[#1D1D21]">
              {{ r.contactNo }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
        <mat-paginator [pageSizeOptions]="[5, 10, 25, 50]" showFirstLastButtons> </mat-paginator>
      </div>
    </div>
  </div>
</div>

@if(isAdding()){
<app-modal
  [isOpen]="isAdding()"
  (closed)="isAdding.set(false)"
  [title]="'Add Counter Party Details'"
>
  <app-counterparty-form [counterPartyTypesData]="counterPartyTypesData()">

  </app-counterparty-form>
</app-modal>
} @if(isDeleting()){
<app-confirm-dialog
  [variant]="'danger'"
  [text]="'Are you sure you want to delete this counterparty?'"
  [open]="isDeleting()"
  (closed)="isDeleting.set(false)"
></app-confirm-dialog>
} @if(isViewing()){
<app-modal
  [isOpen]="isViewing()"
  [isButtonsShowing]="isButtonsShowing()"
  (closed)="isViewing.set(false)"
  [title]="'Counterparty: Ace Corporation'"
>
  <app-view-counterparty-information [viewCounterPartyData]="viewCounterPartyData()">
  </app-view-counterparty-information>
</app-modal>
}
